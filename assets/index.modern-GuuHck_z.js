var Q,M,fe=(Q=function(t,e){function r(n){if(!Number.isSafeInteger(n))throw new Error(`Wrong integer: ${n}`)}function i(...n){const s=(o,u)=>p=>o(u(p));return{encode:Array.from(n).reverse().reduce((o,u)=>o?s(o,u.encode):u.encode,void 0),decode:n.reduce((o,u)=>o?s(o,u.decode):u.decode,void 0)}}function a(n){return{encode:s=>{if(!Array.isArray(s)||s.length&&typeof s[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return s.map(o=>{if(r(o),o<0||o>=n.length)throw new Error(`Digit index outside alphabet: ${o} (alphabet: ${n.length})`);return n[o]})},decode:s=>{if(!Array.isArray(s)||s.length&&typeof s[0]!="string")throw new Error("alphabet.decode input should be array of strings");return s.map(o=>{if(typeof o!="string")throw new Error(`alphabet.decode: not string element=${o}`);const u=n.indexOf(o);if(u===-1)throw new Error(`Unknown letter: "${o}". Allowed: ${n}`);return u})}}}function c(n=""){if(typeof n!="string")throw new Error("join separator should be string");return{encode:s=>{if(!Array.isArray(s)||s.length&&typeof s[0]!="string")throw new Error("join.encode input should be array of strings");for(let o of s)if(typeof o!="string")throw new Error(`join.encode: non-string input=${o}`);return s.join(n)},decode:s=>{if(typeof s!="string")throw new Error("join.decode input should be string");return s.split(n)}}}function h(n,s="="){if(r(n),typeof s!="string")throw new Error("padding chr should be string");return{encode(o){if(!Array.isArray(o)||o.length&&typeof o[0]!="string")throw new Error("padding.encode input should be array of strings");for(let u of o)if(typeof u!="string")throw new Error(`padding.encode: non-string input=${u}`);for(;o.length*n%8;)o.push(s);return o},decode(o){if(!Array.isArray(o)||o.length&&typeof o[0]!="string")throw new Error("padding.encode input should be array of strings");for(let p of o)if(typeof p!="string")throw new Error(`padding.decode: non-string input=${p}`);let u=o.length;if(u*n%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;u>0&&o[u-1]===s;u--)if(!((u-1)*n%8))throw new Error("Invalid padding: string has too much padding");return o.slice(0,u)}}}function f(n){if(typeof n!="function")throw new Error("normalize fn should be function");return{encode:s=>s,decode:s=>n(s)}}function v(n,s,o){if(s<2)throw new Error(`convertRadix: wrong from=${s}, base cannot be less than 2`);if(o<2)throw new Error(`convertRadix: wrong to=${o}, base cannot be less than 2`);if(!Array.isArray(n))throw new Error("convertRadix: data should be array");if(!n.length)return[];let u=0;const p=[],w=Array.from(n);for(w.forEach(l=>{if(r(l),l<0||l>=s)throw new Error(`Wrong integer: ${l}`)});;){let l=0,m=!0;for(let b=u;b<w.length;b++){const U=w[b],_=s*l+U;if(!Number.isSafeInteger(_)||s*l/s!==l||_-U!=s*l)throw new Error("convertRadix: carry overflow");if(l=_%o,w[b]=Math.floor(_/o),!Number.isSafeInteger(w[b])||w[b]*o+l!==_)throw new Error("convertRadix: carry overflow");m&&(w[b]?m=!1:u=b)}if(p.push(l),m)break}for(let l=0;l<n.length-1&&n[l]===0;l++)p.push(0);return p.reverse()}Object.defineProperty(e,"__esModule",{value:!0}),e.bytes=e.stringToBytes=e.str=e.bytesToString=e.hex=e.utf8=e.bech32m=e.bech32=e.base58check=e.base58xmr=e.base58xrp=e.base58flickr=e.base58=e.base64url=e.base64=e.base32crockford=e.base32hex=e.base32=e.base16=e.utils=e.assertNumber=void 0,e.assertNumber=r;const k=(n,s)=>s?k(s,n%s):n,A=(n,s)=>n+(s-k(n,s));function d(n,s,o,u){if(!Array.isArray(n))throw new Error("convertRadix2: data should be array");if(s<=0||s>32)throw new Error(`convertRadix2: wrong from=${s}`);if(o<=0||o>32)throw new Error(`convertRadix2: wrong to=${o}`);if(A(s,o)>32)throw new Error(`convertRadix2: carry overflow from=${s} to=${o} carryBits=${A(s,o)}`);let p=0,w=0;const l=2**o-1,m=[];for(const b of n){if(r(b),b>=2**s)throw new Error(`convertRadix2: invalid data word=${b} from=${s}`);if(p=p<<s|b,w+s>32)throw new Error(`convertRadix2: carry overflow pos=${w} from=${s}`);for(w+=s;w>=o;w-=o)m.push((p>>w-o&l)>>>0);p&=2**w-1}if(p=p<<o-w&l,!u&&w>=s)throw new Error("Excess padding");if(!u&&p)throw new Error(`Non-zero padding: ${p}`);return u&&w>0&&m.push(p>>>0),m}function g(n){return r(n),{encode:s=>{if(!(s instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return v(Array.from(s),256,n)},decode:s=>{if(!Array.isArray(s)||s.length&&typeof s[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(v(s,n,256))}}}function y(n,s=!1){if(r(n),n<=0||n>32)throw new Error("radix2: bits should be in (0..32]");if(A(8,n)>32||A(n,8)>32)throw new Error("radix2: carry overflow");return{encode:o=>{if(!(o instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return d(Array.from(o),8,n,!s)},decode:o=>{if(!Array.isArray(o)||o.length&&typeof o[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(d(o,n,8,s))}}}function E(n){if(typeof n!="function")throw new Error("unsafeWrapper fn should be function");return function(...s){try{return n.apply(null,s)}catch{}}}function D(n,s){if(r(n),typeof s!="function")throw new Error("checksum fn should be function");return{encode(o){if(!(o instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const u=s(o).slice(0,n),p=new Uint8Array(o.length+n);return p.set(o),p.set(u,o.length),p},decode(o){if(!(o instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const u=o.slice(0,-n),p=s(u).slice(0,n),w=o.slice(-n);for(let l=0;l<n;l++)if(p[l]!==w[l])throw new Error("Invalid checksum");return u}}}e.utils={alphabet:a,chain:i,checksum:D,radix:g,radix2:y,join:c,padding:h},e.base16=i(y(4),a("0123456789ABCDEF"),c("")),e.base32=i(y(5),a("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),h(5),c("")),e.base32hex=i(y(5),a("0123456789ABCDEFGHIJKLMNOPQRSTUV"),h(5),c("")),e.base32crockford=i(y(5),a("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),c(""),f(n=>n.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),e.base64=i(y(6),a("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),h(6),c("")),e.base64url=i(y(6),a("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),h(6),c(""));const x=n=>i(g(58),a(n),c(""));e.base58=x("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),e.base58flickr=x("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),e.base58xrp=x("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const $=[0,2,3,5,6,7,9,10,11];e.base58xmr={encode(n){let s="";for(let o=0;o<n.length;o+=8){const u=n.subarray(o,o+8);s+=e.base58.encode(u).padStart($[u.length],"1")}return s},decode(n){let s=[];for(let o=0;o<n.length;o+=11){const u=n.slice(o,o+11),p=$.indexOf(u.length),w=e.base58.decode(u);for(let l=0;l<w.length-p;l++)if(w[l]!==0)throw new Error("base58xmr: wrong padding");s=s.concat(Array.from(w.slice(w.length-p)))}return Uint8Array.from(s)}},e.base58check=n=>i(D(4,s=>n(n(s))),e.base58);const H=i(a("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),c("")),L=[996825010,642813549,513874426,1027748829,705979059];function P(n){const s=n>>25;let o=(33554431&n)<<5;for(let u=0;u<L.length;u++)(s>>u&1)==1&&(o^=L[u]);return o}function N(n,s,o=1){const u=n.length;let p=1;for(let w=0;w<u;w++){const l=n.charCodeAt(w);if(l<33||l>126)throw new Error(`Invalid prefix (${n})`);p=P(p)^l>>5}p=P(p);for(let w=0;w<u;w++)p=P(p)^31&n.charCodeAt(w);for(let w of s)p=P(p)^w;for(let w=0;w<6;w++)p=P(p);return p^=o,H.encode(d([p%1073741824],30,5,!1))}function j(n){const s=n==="bech32"?1:734539939,o=y(5),u=o.decode,p=o.encode,w=E(u);function l(m,b=90){if(typeof m!="string")throw new Error("bech32.decode input should be string, not "+typeof m);if(m.length<8||b!==!1&&m.length>b)throw new TypeError(`Wrong string length: ${m.length} (${m}). Expected (8..${b})`);const U=m.toLowerCase();if(m!==U&&m!==m.toUpperCase())throw new Error("String must be lowercase or uppercase");const _=(m=U).lastIndexOf("1");if(_===0||_===-1)throw new Error('Letter "1" must be present between prefix and data only');const K=m.slice(0,_),z=m.slice(_+1);if(z.length<6)throw new Error("Data must be at least 6 characters long");const X=H.decode(z).slice(0,-6),Y=N(K,X,s);if(!z.endsWith(Y))throw new Error(`Invalid checksum in ${m}: expected "${Y}"`);return{prefix:K,words:X}}return{encode:function(m,b,U=90){if(typeof m!="string")throw new Error("bech32.encode prefix should be string, not "+typeof m);if(!Array.isArray(b)||b.length&&typeof b[0]!="number")throw new Error("bech32.encode words should be array of numbers, not "+typeof b);const _=m.length+7+b.length;if(U!==!1&&_>U)throw new TypeError(`Length ${_} exceeds limit ${U}`);return`${m=m.toLowerCase()}1${H.encode(b)}${N(m,b,s)}`},decode:l,decodeToBytes:function(m){const{prefix:b,words:U}=l(m,!1);return{prefix:b,words:U,bytes:u(U)}},decodeUnsafe:E(l),fromWords:u,fromWordsUnsafe:w,toWords:p}}e.bech32=j("bech32"),e.bech32m=j("bech32m"),e.utf8={encode:n=>new TextDecoder().decode(n),decode:n=>new TextEncoder().encode(n)},e.hex=i(y(4),a("0123456789abcdef"),c(""),f(n=>{if(typeof n!="string"||n.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof n} with length ${n.length}`);return n.toLowerCase()}));const T={utf8:e.utf8,hex:e.hex,base16:e.base16,base32:e.base32,base64:e.base64,base64url:e.base64url,base58:e.base58,base58xmr:e.base58xmr},C=`Invalid encoding type. Available types: ${Object.keys(T).join(", ")}`;e.bytesToString=(n,s)=>{if(typeof n!="string"||!T.hasOwnProperty(n))throw new TypeError(C);if(!(s instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return T[n].encode(s)},e.str=e.bytesToString,e.stringToBytes=(n,s)=>{if(!T.hasOwnProperty(n))throw new TypeError(C);if(typeof s!="string")throw new TypeError("stringToBytes() expects string");return T[n].decode(s)},e.bytes=e.stringToBytes},Q(M={exports:{}},M.exports),M.exports);const{bech32:S,hex:I,utf8:de}=fe,ee={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},te={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},re={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},ne={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},se={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},O=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],pe={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},we=BigInt("2100000000000000000"),oe=BigInt(1e11),Z={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},ce={};for(let t=0,e=Object.keys(Z);t<e.length;t++){const r=e[t],i=Z[e[t]].toString();ce[i]=r}const ye={1:t=>I.encode(S.fromWordsUnsafe(t)),16:t=>I.encode(S.fromWordsUnsafe(t)),13:t=>de.encode(S.fromWordsUnsafe(t)),19:t=>I.encode(S.fromWordsUnsafe(t)),23:t=>I.encode(S.fromWordsUnsafe(t)),27:t=>I.encode(S.fromWordsUnsafe(t)),6:q,24:q,3:function(t){const e=[];let r,i,a,c,h,f=S.fromWordsUnsafe(t);for(;f.length>0;)r=I.encode(f.slice(0,33)),i=I.encode(f.slice(33,41)),a=parseInt(I.encode(f.slice(41,45)),16),c=parseInt(I.encode(f.slice(45,49)),16),h=parseInt(I.encode(f.slice(49,51)),16),f=f.slice(51),e.push({pubkey:r,short_channel_id:i,fee_base_msat:a,fee_proportional_millionths:c,cltv_expiry_delta:h});return e},5:function(t){const e=t.slice().reverse().map(a=>[!!(1&a),!!(2&a),!!(4&a),!!(8&a),!!(16&a)]).reduce((a,c)=>a.concat(c),[]);for(;e.length<2*O.length;)e.push(!1);const r={};O.forEach((a,c)=>{let h;h=e[2*c]?"required":e[2*c+1]?"supported":"unsupported",r[a]=h});const i=e.slice(2*O.length);return r.extra_bits={start_bit:2*O.length,bits:i,has_required:i.reduce((a,c,h)=>h%2!=0?a||!1:a||c,!1)},r}};function me(t){return e=>({tagCode:parseInt(t),words:S.encode("unknown",e,Number.MAX_SAFE_INTEGER)})}function q(t){return t.reverse().reduce((e,r,i)=>e+r*Math.pow(32,i),0)}const ge=t=>Uint8Array.from(t.match(/.{1,2}/g).map(e=>parseInt(e,16))),be=t=>{if(!t)return null;try{const e=function(d,g){if(typeof d!="string")throw new Error("Lightning Payment Request must be string");if(d.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");const y=[],E=S.decode(d,Number.MAX_SAFE_INTEGER);d=d.toLowerCase();const D=E.prefix;let x=E.words,$=d.slice(D.length+1),H=x.slice(-104);x=x.slice(0,-104);let L=D.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(L&&!L[2]&&(L=D.match(/^ln(\S+)$/)),!L)throw new Error("Not a proper lightning payment request");y.push({name:"lightning_network",letters:"ln"});const P=L[1];let N;switch(P){case ee.bech32:N=ee;break;case te.bech32:N=te;break;case re.bech32:N=re;break;case ne.bech32:N=ne;break;case se.bech32:N=se}if(!N||N.bech32!==P)throw new Error("Unknown coin bech32 prefix");y.push({name:"coin_network",letters:P,value:N});const j=L[2];let T;j?(T=function(l,m){let b,U;if(l.slice(-1).match(/^[munp]$/))b=l.slice(-1),U=l.slice(0,-1);else{if(l.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");U=l}if(!U.match(/^\d+$/))throw new Error("Not a valid human readable amount");const _=BigInt(U),K=b?_*oe/pe[b]:_*oe;if(b==="p"&&_%BigInt(10)!==BigInt(0)||K>we)throw new Error("Amount is outside of valid range");return K.toString()}(j+L[3]),y.push({name:"amount",letters:L[2]+L[3],value:T})):T=null,y.push({name:"separator",letters:"1"});const C=q(x.slice(0,7));let n,s,o,u;for(x=x.slice(7),y.push({name:"timestamp",letters:$.slice(0,7),value:C}),$=$.slice(7);x.length>0;){const l=x[0].toString();n=ce[l]||"unknown_tag",s=ye[l]||me(l),x=x.slice(1),o=q(x.slice(0,2)),x=x.slice(2),u=x.slice(0,o),x=x.slice(o),y.push({name:n,tag:$[0],letters:$.slice(0,3+o),value:s(u)}),$=$.slice(3+o)}y.push({name:"signature",letters:$.slice(0,104),value:I.encode(S.fromWordsUnsafe(H))}),$=$.slice(104),y.push({name:"checksum",letters:$});let p={paymentRequest:d,sections:y,get expiry(){let l=y.find(m=>m.name==="expiry");if(l)return w("timestamp")+l.value},get route_hints(){return y.filter(l=>l.name==="route_hint").map(l=>l.value)}};for(let l in Z)l!=="route_hint"&&Object.defineProperty(p,l,{get:()=>w(l)});return p;function w(l){let m=y.find(b=>b.name===l);return m?m.value:void 0}}(t);if(!e||!e.sections)return null;const r=e.sections.find(d=>d.name==="payment_hash");if((r==null?void 0:r.name)!=="payment_hash"||!r.value)return null;const i=r.value;let a=0;const c=e.sections.find(d=>d.name==="amount");(c==null?void 0:c.name)==="amount"&&c.value&&(a=parseInt(c.value)/1e3);const h=e.sections.find(d=>d.name==="timestamp");if((h==null?void 0:h.name)!=="timestamp"||!h.value)return null;const f=h.value;let v;const k=e.sections.find(d=>d.name==="expiry");(k==null?void 0:k.name)==="expiry"&&(v=k.value);const A=e.sections.find(d=>d.name==="description");return{paymentHash:i,satoshi:a,timestamp:f,expiry:v,description:(A==null?void 0:A.name)==="description"?A==null?void 0:A.value:void 0}}catch{return null}};function ie(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}const he=t=>t instanceof Uint8Array,G=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),R=(t,e)=>t<<32-e|t>>>e;if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");const ve=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function V(t){if(!he(t))throw new Error("Uint8Array expected");let e="";for(let r=0;r<t.length;r++)e+=ve[t[r]];return e}function le(t){if(typeof t=="string"&&(t=function(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))}(t)),!he(t))throw new Error("expected Uint8Array, got "+typeof t);return t}class Ee{clone(){return this._cloneInto()}}function xe(t){const e=i=>t().update(le(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}class Ae extends Ee{constructor(e,r,i,a){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=G(this.buffer)}update(e){ie(this);const{view:r,buffer:i,blockLen:a}=this,c=(e=le(e)).length;for(let h=0;h<c;){const f=Math.min(a-this.pos,c-h);if(f!==a)i.set(e.subarray(h,h+f),this.pos),this.pos+=f,h+=f,this.pos===a&&(this.process(r,0),this.pos=0);else{const v=G(e);for(;a<=c-h;h+=a)this.process(v,h)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){ie(this),function(d,g){(function(E,...D){if(!(E instanceof Uint8Array))throw new Error("Expected Uint8Array");if(D.length>0&&!D.includes(E.length))throw new Error(`Expected Uint8Array of length ${D}, not of length=${E.length}`)})(d);const y=g.outputLen;if(d.length<y)throw new Error(`digestInto() expects output buffer of length at least ${y}`)}(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:a,isLE:c}=this;let{pos:h}=this;r[h++]=128,this.buffer.subarray(h).fill(0),this.padOffset>a-h&&(this.process(i,0),h=0);for(let d=h;d<a;d++)r[d]=0;(function(d,g,y,E){if(typeof d.setBigUint64=="function")return d.setBigUint64(g,y,E);const D=BigInt(32),x=BigInt(4294967295),$=Number(y>>D&x),H=Number(y&x),L=E?0:4;d.setUint32(g+(E?4:0),$,E),d.setUint32(g+L,H,E)})(i,a-8,BigInt(8*this.length),c),this.process(i,0);const f=G(e),v=this.outputLen;if(v%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const k=v/4,A=this.get();if(k>A.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<k;d++)f.setUint32(4*d,A[d],c)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:a,finished:c,destroyed:h,pos:f}=this;return e.length=a,e.pos=f,e.finished=c,e.destroyed=h,a%r&&e.buffer.set(i),e}}const ke=(t,e,r)=>t&e^t&r^e&r,Ue=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),W=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),B=new Uint32Array(64);class _e extends Ae{constructor(){super(64,32,8,!1),this.A=0|W[0],this.B=0|W[1],this.C=0|W[2],this.D=0|W[3],this.E=0|W[4],this.F=0|W[5],this.G=0|W[6],this.H=0|W[7]}get(){const{A:e,B:r,C:i,D:a,E:c,F:h,G:f,H:v}=this;return[e,r,i,a,c,h,f,v]}set(e,r,i,a,c,h,f,v){this.A=0|e,this.B=0|r,this.C=0|i,this.D=0|a,this.E=0|c,this.F=0|h,this.G=0|f,this.H=0|v}process(e,r){for(let g=0;g<16;g++,r+=4)B[g]=e.getUint32(r,!1);for(let g=16;g<64;g++){const y=B[g-15],E=B[g-2],D=R(y,7)^R(y,18)^y>>>3,x=R(E,17)^R(E,19)^E>>>10;B[g]=x+B[g-7]+D+B[g-16]|0}let{A:i,B:a,C:c,D:h,E:f,F:v,G:k,H:A}=this;for(let g=0;g<64;g++){const y=A+(R(f,6)^R(f,11)^R(f,25))+((d=f)&v^~d&k)+Ue[g]+B[g]|0,E=(R(i,2)^R(i,13)^R(i,22))+ke(i,a,c)|0;A=k,k=v,v=f,f=h+y|0,h=c,c=a,a=i,i=y+E|0}var d;i=i+this.A|0,a=a+this.B|0,c=c+this.C|0,h=h+this.D|0,f=f+this.E|0,v=v+this.F|0,k=k+this.G|0,A=A+this.H|0,this.set(i,a,c,h,f,v,k,A)}roundClean(){B.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const F=xe(()=>new _e);class $e{constructor(e){var r,i,a,c;if(this.paymentRequest=void 0,this.paymentHash=void 0,this.preimage=void 0,this.verify=void 0,this.satoshi=void 0,this.expiry=void 0,this.timestamp=void 0,this.createdDate=void 0,this.expiryDate=void 0,this.description=void 0,this.successAction=void 0,this.paymentRequest=e.pr,!this.paymentRequest)throw new Error("Invalid payment request");const h=be(this.paymentRequest);if(!h)throw new Error("Failed to decode payment request");this.paymentHash=h.paymentHash,this.satoshi=h.satoshi,this.timestamp=h.timestamp,this.expiry=h.expiry,this.createdDate=new Date(1e3*this.timestamp),this.expiryDate=this.expiry?new Date(1e3*(this.timestamp+this.expiry)):void 0,this.description=(r=h.description)!=null?r:null,this.verify=(i=e.verify)!=null?i:null,this.preimage=(a=e.preimage)!=null?a:null,this.successAction=(c=e.successAction)!=null?c:null}async isPaid(){if(this.preimage)return this.validatePreimage(this.preimage);if(this.verify)return await this.verifyPayment();throw new Error("Could not verify payment")}validatePreimage(e){if(!e||!this.paymentHash)return!1;try{const r=V(F(ge(e)));return this.paymentHash===r}catch{return!1}}async verifyPayment(){try{if(!this.verify)throw new Error("LNURL verify not available");const e=await fetch(this.verify);if(!e.ok)throw new Error(`Verification request failed: ${e.status} ${e.statusText}`);const r=await e.json();return r.preimage&&(this.preimage=r.preimage),r.settled}catch(e){return console.error("Failed to check LNURL-verify",e),!1}}hasExpired(){const{expiryDate:e}=this;return!!e&&e.getTime()<Date.now()}}const De=t=>{if(t.tag!=="keysend")throw new Error("Invalid keysend params");if(t.status!=="OK")throw new Error("Keysend status not OK");if(!t.pubkey)throw new Error("Pubkey does not exist");let e,r;return t.customData&&t.customData[0]&&(e=t.customData[0].customKey,r=t.customData[0].customValue),{destination:t.pubkey,customKey:e,customValue:r}};async function Le({satoshi:t,comment:e,p:r,e:i,relays:a},c={}){const h=c.nostr||globalThis.nostr;if(!h)throw new Error("nostr option or window.nostr is not available");const f=[["relays",...a],["amount",t.toString()]];r&&f.push(["p",r]),i&&f.push(["e",i]);const v={pubkey:await h.getPublicKey(),created_at:Math.floor(Date.now()/1e3),kind:9734,tags:f,content:e??""};return v.id=Re(v),await h.signEvent(v)}function Ne(t){if(typeof t.content!="string"||typeof t.created_at!="number"||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){const r=t.tags[e];if(!Array.isArray(r))return!1;for(let i=0;i<r.length;i++)if(typeof r[i]=="object")return!1}return!0}function Ie(t){if(!Ne(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function Re(t){return V(F(Ie(t)))}function Se(t,e){let r,i;var a,c;return e&&t&&(r=(a=t.names)==null?void 0:a[e],i=r?(c=t.relays)==null?void 0:c[r]:void 0),[t,r,i]}const Pe=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=+$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=+$,\w]+@)[A-Za-z0-9.-]+)((?:\/[+~%/.\w-_]*)?\??(?:[-+=&;%@.\w_]*)#?(?:[\w]*))?)/,ue=t=>!!t&&Pe.test(t),ae=({amount:t,min:e,max:r})=>t>0&&t>=e&&t<=r,Te=async t=>{if(t.tag!=="payRequest")throw new Error("Invalid pay service params");const e=(t.callback+"").trim();if(!ue(e))throw new Error("Callback must be a valid url");const r=Math.ceil(Number(t.minSendable||0)),i=Math.floor(Number(t.maxSendable));if(!r||!i||r>i)throw new Error("Invalid pay service params");let a,c;try{a=JSON.parse(t.metadata+""),c=V(F(t.metadata+""))}catch{a=[],c=V(F("[]"))}let h="",f="",v="",k="";for(let g=0;g<a.length;g++){const[y,E]=a[g];switch(y){case"text/plain":v=E;break;case"text/identifier":k=E;break;case"text/email":h=E;break;case"image/png;base64":case"image/jpeg;base64":f="data:"+y+","+E}}const A=t.payerData;let d;try{d=new URL(e).hostname}catch{}return{callback:e,fixed:r===i,min:r,max:i,domain:d,metadata:a,metadataHash:c,identifier:k,email:h,description:v,image:f,payerData:A,commentAllowed:Number(t.commentAllowed)||0,rawData:t,allowsNostr:t.allowsNostr||!1}};function J(){return J=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},J.apply(this,arguments)}const We=async(t,e)=>{const{boost:r}=t;e||(e={});const i=e.webln||globalThis.webln;if(!i)throw new Error("WebLN not available");if(!i.keysend)throw new Error("Keysend not available in current WebLN provider");const a=t.amount||Math.floor(r.value_msat/1e3),c={destination:t.destination,amount:a,customRecords:{7629169:JSON.stringify(r)}};return t.customKey&&t.customValue&&(c.customRecords[t.customKey]=t.customValue),await i.enable(),await i.keysend(c)},Be=/^((?:[^<>()[\]\\.,;:\s@"]+(?:\.[^<>()[\]\\.,;:\s@"]+)*)|(?:".+"))@((?:\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(?:(?:[a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;class He{constructor(e,r){this.address=void 0,this.options=void 0,this.username=void 0,this.domain=void 0,this.pubkey=void 0,this.lnurlpData=void 0,this.keysendData=void 0,this.nostrData=void 0,this.nostrPubkey=void 0,this.nostrRelays=void 0,this.webln=void 0,this.address=e,this.options={proxy:"https://api.getalby.com/lnurl"},this.options=Object.assign(this.options,r),this.parse(),this.webln=this.options.webln}parse(){const e=Be.exec(this.address.toLowerCase());e&&(this.username=e[1],this.domain=e[2])}getWebLN(){return this.webln||globalThis.webln}async fetch(){return this.options.proxy?this.fetchWithProxy():this.fetchWithoutProxy()}async fetchWithProxy(){const e=await fetch(`${this.options.proxy}/lightning-address-details?${new URLSearchParams({ln:this.address}).toString()}`);if(!e.ok)throw new Error(`Failed to fetch lnurl info: ${e.status} ${e.statusText}`);const r=await e.json();await this.parseLnUrlPayResponse(r.lnurlp),this.parseKeysendResponse(r.keysend),this.parseNostrResponse(r.nostr)}async fetchWithoutProxy(){this.domain&&this.username&&await Promise.all([this.fetchLnurlData(),this.fetchKeysendData(),this.fetchNostrData()])}async fetchLnurlData(){const e=await fetch(this.lnurlpUrl());if(e.ok){const r=await e.json();await this.parseLnUrlPayResponse(r)}}async fetchKeysendData(){const e=await fetch(this.keysendUrl());if(e.ok){const r=await e.json();this.parseKeysendResponse(r)}}async fetchNostrData(){const e=await fetch(this.nostrUrl());if(e.ok){const r=await e.json();this.parseNostrResponse(r)}}lnurlpUrl(){return`https://${this.domain}/.well-known/lnurlp/${this.username}`}keysendUrl(){return`https://${this.domain}/.well-known/keysend/${this.username}`}nostrUrl(){return`https://${this.domain}/.well-known/nostr.json?name=${this.username}`}async generateInvoice(e){let r;if(this.options.proxy){const c=await fetch(`${this.options.proxy}/generate-invoice?${new URLSearchParams(J({ln:this.address},e)).toString()}`);if(!c.ok)throw new Error(`Failed to generate invoice: ${c.status} ${c.statusText}`);r=(await c.json()).invoice}else{if(!this.lnurlpData)throw new Error("No lnurlpData available. Please call fetch() first.");if(!this.lnurlpData.callback||!ue(this.lnurlpData.callback))throw new Error("Valid callback does not exist in lnurlpData");const c=new URL(this.lnurlpData.callback);c.search=new URLSearchParams(e).toString();const h=await fetch(c.toString());if(!h.ok)throw new Error(`Failed to generate invoice: ${h.status} ${h.statusText}`);r=await h.json()}const i=r&&r.pr&&r.pr.toString();if(!i)throw new Error("Invalid pay service invoice");const a={pr:i};if(r&&r.verify&&(a.verify=r.verify.toString()),r&&r.successAction&&typeof r.successAction=="object"){const{tag:c,message:h,description:f,url:v}=r.successAction;c==="message"?a.successAction={tag:c,message:h}:c==="url"&&(a.successAction={tag:c,description:f,url:v})}return new $e(a)}async requestInvoice(e){if(!this.lnurlpData)throw new Error("No lnurlpData available. Please call fetch() first.");const r=1e3*e.satoshi,{commentAllowed:i,min:a,max:c}=this.lnurlpData;if(!ae({amount:r,min:a,max:c}))throw new Error("Invalid amount");if(e.comment&&i&&i>0&&e.comment.length>i)throw new Error(`The comment length must be ${i} characters or fewer`);const h={amount:r.toString()};return e.comment&&(h.comment=e.comment),e.payerdata&&(h.payerdata=JSON.stringify(e.payerdata)),this.generateInvoice(h)}async boost(e,r=0){if(!this.keysendData)throw new Error("No keysendData available. Please call fetch() first.");const{destination:i,customKey:a,customValue:c}=this.keysendData,h=this.getWebLN();if(!h)throw new Error("WebLN not available");return We({destination:i,customKey:a,customValue:c,amount:r,boost:e},{webln:h})}async zapInvoice({satoshi:e,comment:r,relays:i,e:a},c={}){if(!this.lnurlpData)throw new Error("No lnurlpData available. Please call fetch() first.");if(!this.nostrPubkey)throw new Error("Nostr Pubkey is missing");const h=this.nostrPubkey,f=1e3*e,{allowsNostr:v,min:k,max:A}=this.lnurlpData;if(!ae({amount:f,min:k,max:A}))throw new Error("Invalid amount");if(!v)throw new Error("Your provider does not support zaps");const d=await Le({satoshi:f,comment:r,p:h,e:a,relays:i},c),g={amount:f.toString(),nostr:JSON.stringify(d)};return await this.generateInvoice(g)}async zap(e,r={}){const i=this.zapInvoice(e,r),a=this.getWebLN();if(!a)throw new Error("WebLN not available");return await a.enable(),a.sendPayment((await i).paymentRequest)}async parseLnUrlPayResponse(e){e&&(this.lnurlpData=await Te(e))}parseKeysendResponse(e){e&&(this.keysendData=De(e))}parseNostrResponse(e){e&&([this.nostrData,this.nostrPubkey,this.nostrRelays]=Se(e,this.username))}}export{$e as Invoice,Be as LN_ADDRESS_REGEX,He as LightningAddress,be as decodeInvoice,ge as fromHexString,Le as generateZapEvent,Re as getEventHash,ue as isUrl,ae as isValidAmount,De as parseKeysendResponse,Te as parseLnUrlPayResponse,Se as parseNostrResponse,We as sendBoostagram,Ie as serializeEvent,Ne as validateEvent};
