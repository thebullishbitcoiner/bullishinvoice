var F,D,ee=(F=function(f,o){function h(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function p(...e){const r=(n,s)=>i=>n(s(i));return{encode:Array.from(e).reverse().reduce((n,s)=>n?r(n,s.encode):s.encode,void 0),decode:e.reduce((n,s)=>n?r(n,s.decode):s.decode,void 0)}}function d(e){return{encode:r=>{if(!Array.isArray(r)||r.length&&typeof r[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return r.map(n=>{if(h(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]})},decode:r=>{if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("alphabet.decode input should be array of strings");return r.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const s=e.indexOf(n);if(s===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return s})}}}function u(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:r=>{if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of r)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return r.join(e)},decode:r=>{if(typeof r!="string")throw new Error("join.decode input should be string");return r.split(e)}}}function y(e,r="="){if(h(e),typeof r!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let s of n)if(typeof s!="string")throw new Error(`padding.encode: non-string input=${s}`);for(;n.length*e%8;)n.push(r);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of n)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let s=n.length;if(s*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;s>0&&n[s-1]===r;s--)if(!((s-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,s)}}}function x(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:r=>r,decode:r=>e(r)}}function B(e,r,n){if(r<2)throw new Error(`convertRadix: wrong from=${r}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let s=0;const i=[],a=Array.from(e);for(a.forEach(t=>{if(h(t),t<0||t>=r)throw new Error(`Wrong integer: ${t}`)});;){let t=0,c=!0;for(let l=s;l<a.length;l++){const m=a[l],E=r*t+m;if(!Number.isSafeInteger(E)||r*t/r!==t||E-m!=r*t)throw new Error("convertRadix: carry overflow");if(t=E%n,a[l]=Math.floor(E/n),!Number.isSafeInteger(a[l])||a[l]*n+t!==E)throw new Error("convertRadix: carry overflow");c&&(a[l]?c=!1:s=l)}if(i.push(t),c)break}for(let t=0;t<e.length-1&&e[t]===0;t++)i.push(0);return i.reverse()}Object.defineProperty(o,"__esModule",{value:!0}),o.bytes=o.stringToBytes=o.str=o.bytesToString=o.hex=o.utf8=o.bech32m=o.bech32=o.base58check=o.base58xmr=o.base58xrp=o.base58flickr=o.base58=o.base64url=o.base64=o.base32crockford=o.base32hex=o.base32=o.base16=o.utils=o.assertNumber=void 0,o.assertNumber=h;const W=(e,r)=>r?W(r,e%r):e,U=(e,r)=>e+(r-W(e,r));function g(e,r,n,s){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(r<=0||r>32)throw new Error(`convertRadix2: wrong from=${r}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(U(r,n)>32)throw new Error(`convertRadix2: carry overflow from=${r} to=${n} carryBits=${U(r,n)}`);let i=0,a=0;const t=2**n-1,c=[];for(const l of e){if(h(l),l>=2**r)throw new Error(`convertRadix2: invalid data word=${l} from=${r}`);if(i=i<<r|l,a+r>32)throw new Error(`convertRadix2: carry overflow pos=${a} from=${r}`);for(a+=r;a>=n;a-=n)c.push((i>>a-n&t)>>>0);i&=2**a-1}if(i=i<<n-a&t,!s&&a>=r)throw new Error("Excess padding");if(!s&&i)throw new Error(`Non-zero padding: ${i}`);return s&&a>0&&c.push(i>>>0),c}function O(e){return h(e),{encode:r=>{if(!(r instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return B(Array.from(r),256,e)},decode:r=>{if(!Array.isArray(r)||r.length&&typeof r[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(B(r,e,256))}}}function w(e,r=!1){if(h(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(U(8,e)>32||U(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return g(Array.from(n),8,e,!r)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(g(n,e,8,r))}}}function N(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...r){try{return e.apply(null,r)}catch{}}}function S(e,r){if(h(e),typeof r!="function")throw new Error("checksum fn should be function");return{encode(n){if(!(n instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const s=r(n).slice(0,e),i=new Uint8Array(n.length+e);return i.set(n),i.set(s,n.length),i},decode(n){if(!(n instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const s=n.slice(0,-e),i=r(s).slice(0,e),a=n.slice(-e);for(let t=0;t<e;t++)if(i[t]!==a[t])throw new Error("Invalid checksum");return s}}}o.utils={alphabet:d,chain:p,checksum:S,radix:O,radix2:w,join:u,padding:y},o.base16=p(w(4),d("0123456789ABCDEF"),u("")),o.base32=p(w(5),d("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),y(5),u("")),o.base32hex=p(w(5),d("0123456789ABCDEFGHIJKLMNOPQRSTUV"),y(5),u("")),o.base32crockford=p(w(5),d("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),u(""),x(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),o.base64=p(w(6),d("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),y(6),u("")),o.base64url=p(w(6),d("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),y(6),u(""));const b=e=>p(O(58),d(e),u(""));o.base58=b("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),o.base58flickr=b("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),o.base58xrp=b("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const v=[0,2,3,5,6,7,9,10,11];o.base58xmr={encode(e){let r="";for(let n=0;n<e.length;n+=8){const s=e.subarray(n,n+8);r+=o.base58.encode(s).padStart(v[s.length],"1")}return r},decode(e){let r=[];for(let n=0;n<e.length;n+=11){const s=e.slice(n,n+11),i=v.indexOf(s.length),a=o.base58.decode(s);for(let t=0;t<a.length-i;t++)if(a[t]!==0)throw new Error("base58xmr: wrong padding");r=r.concat(Array.from(a.slice(a.length-i)))}return Uint8Array.from(r)}},o.base58check=e=>p(S(4,r=>e(e(r))),o.base58);const R=p(d("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),u("")),A=[996825010,642813549,513874426,1027748829,705979059];function I(e){const r=e>>25;let n=(33554431&e)<<5;for(let s=0;s<A.length;s++)(r>>s&1)==1&&(n^=A[s]);return n}function _(e,r,n=1){const s=e.length;let i=1;for(let a=0;a<s;a++){const t=e.charCodeAt(a);if(t<33||t>126)throw new Error(`Invalid prefix (${e})`);i=I(i)^t>>5}i=I(i);for(let a=0;a<s;a++)i=I(i)^31&e.charCodeAt(a);for(let a of r)i=I(i)^a;for(let a=0;a<6;a++)i=I(i);return i^=n,R.encode(g([i%1073741824],30,5,!1))}function C(e){const r=e==="bech32"?1:734539939,n=w(5),s=n.decode,i=n.encode,a=N(s);function t(c,l=90){if(typeof c!="string")throw new Error("bech32.decode input should be string, not "+typeof c);if(c.length<8||l!==!1&&c.length>l)throw new TypeError(`Wrong string length: ${c.length} (${c}). Expected (8..${l})`);const m=c.toLowerCase();if(c!==m&&c!==c.toUpperCase())throw new Error("String must be lowercase or uppercase");const E=(c=m).lastIndexOf("1");if(E===0||E===-1)throw new Error('Letter "1" must be present between prefix and data only');const H=c.slice(0,E),P=c.slice(E+1);if(P.length<6)throw new Error("Data must be at least 6 characters long");const M=R.decode(P).slice(0,-6),V=_(H,M,r);if(!P.endsWith(V))throw new Error(`Invalid checksum in ${c}: expected "${V}"`);return{prefix:H,words:M}}return{encode:function(c,l,m=90){if(typeof c!="string")throw new Error("bech32.encode prefix should be string, not "+typeof c);if(!Array.isArray(l)||l.length&&typeof l[0]!="number")throw new Error("bech32.encode words should be array of numbers, not "+typeof l);const E=c.length+7+l.length;if(m!==!1&&E>m)throw new TypeError(`Length ${E} exceeds limit ${m}`);return`${c=c.toLowerCase()}1${R.encode(l)}${_(c,l,r)}`},decode:t,decodeToBytes:function(c){const{prefix:l,words:m}=t(c,!1);return{prefix:l,words:m,bytes:s(m)}},decodeUnsafe:N(t),fromWords:s,fromWordsUnsafe:a,toWords:i}}o.bech32=C("bech32"),o.bech32m=C("bech32m"),o.utf8={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},o.hex=p(w(4),d("0123456789abcdef"),u(""),x(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()}));const T={utf8:o.utf8,hex:o.hex,base16:o.base16,base32:o.base32,base64:o.base64,base64url:o.base64url,base58:o.base58,base58xmr:o.base58xmr},j=`Invalid encoding type. Available types: ${Object.keys(T).join(", ")}`;o.bytesToString=(e,r)=>{if(typeof e!="string"||!T.hasOwnProperty(e))throw new TypeError(j);if(!(r instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return T[e].encode(r)},o.str=o.bytesToString,o.stringToBytes=(e,r)=>{if(!T.hasOwnProperty(e))throw new TypeError(j);if(typeof r!="string")throw new TypeError("stringToBytes() expects string");return T[e].decode(r)},o.bytes=o.stringToBytes},F(D={exports:{}},D.exports),D.exports);const{bech32:k,hex:$,utf8:re}=ee,G={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},z={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},X={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},J={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},Q={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},L=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],ne={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},oe=BigInt("2100000000000000000"),Z=BigInt(1e11),K={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},Y={};for(let f=0,o=Object.keys(K);f<o.length;f++){const h=o[f],p=K[o[f]].toString();Y[p]=h}const te={1:f=>$.encode(k.fromWordsUnsafe(f)),16:f=>$.encode(k.fromWordsUnsafe(f)),13:f=>re.encode(k.fromWordsUnsafe(f)),19:f=>$.encode(k.fromWordsUnsafe(f)),23:f=>$.encode(k.fromWordsUnsafe(f)),27:f=>$.encode(k.fromWordsUnsafe(f)),6:q,24:q,3:function(f){const o=[];let h,p,d,u,y,x=k.fromWordsUnsafe(f);for(;x.length>0;)h=$.encode(x.slice(0,33)),p=$.encode(x.slice(33,41)),d=parseInt($.encode(x.slice(41,45)),16),u=parseInt($.encode(x.slice(45,49)),16),y=parseInt($.encode(x.slice(49,51)),16),x=x.slice(51),o.push({pubkey:h,short_channel_id:p,fee_base_msat:d,fee_proportional_millionths:u,cltv_expiry_delta:y});return o},5:function(f){const o=f.slice().reverse().map(d=>[!!(1&d),!!(2&d),!!(4&d),!!(8&d),!!(16&d)]).reduce((d,u)=>d.concat(u),[]);for(;o.length<2*L.length;)o.push(!1);const h={};L.forEach((d,u)=>{let y;y=o[2*u]?"required":o[2*u+1]?"supported":"unsupported",h[d]=y});const p=o.slice(2*L.length);return h.extra_bits={start_bit:2*L.length,bits:p,has_required:p.reduce((d,u,y)=>y%2!=0?d||!1:d||u,!1)},h}};function se(f){return o=>({tagCode:parseInt(f),words:k.encode("unknown",o,Number.MAX_SAFE_INTEGER)})}function q(f){return f.reverse().reduce((o,h,p)=>o+h*Math.pow(32,p),0)}const ie=f=>{if(!f)return null;try{const o=function(g,O){if(typeof g!="string")throw new Error("Lightning Payment Request must be string");if(g.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");const w=[],N=k.decode(g,Number.MAX_SAFE_INTEGER);g=g.toLowerCase();const S=N.prefix;let b=N.words,v=g.slice(S.length+1),R=b.slice(-104);b=b.slice(0,-104);let A=S.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(A&&!A[2]&&(A=S.match(/^ln(\S+)$/)),!A)throw new Error("Not a proper lightning payment request");w.push({name:"lightning_network",letters:"ln"});const I=A[1];let _;switch(I){case G.bech32:_=G;break;case z.bech32:_=z;break;case X.bech32:_=X;break;case J.bech32:_=J;break;case Q.bech32:_=Q}if(!_||_.bech32!==I)throw new Error("Unknown coin bech32 prefix");w.push({name:"coin_network",letters:I,value:_});const C=A[2];let T;C?(T=function(t,c){let l,m;if(t.slice(-1).match(/^[munp]$/))l=t.slice(-1),m=t.slice(0,-1);else{if(t.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");m=t}if(!m.match(/^\d+$/))throw new Error("Not a valid human readable amount");const E=BigInt(m),H=l?E*Z/ne[l]:E*Z;if(l==="p"&&E%BigInt(10)!==BigInt(0)||H>oe)throw new Error("Amount is outside of valid range");return H.toString()}(C+A[3]),w.push({name:"amount",letters:A[2]+A[3],value:T})):T=null,w.push({name:"separator",letters:"1"});const j=q(b.slice(0,7));let e,r,n,s;for(b=b.slice(7),w.push({name:"timestamp",letters:v.slice(0,7),value:j}),v=v.slice(7);b.length>0;){const t=b[0].toString();e=Y[t]||"unknown_tag",r=te[t]||se(t),b=b.slice(1),n=q(b.slice(0,2)),b=b.slice(2),s=b.slice(0,n),b=b.slice(n),w.push({name:e,tag:v[0],letters:v.slice(0,3+n),value:r(s)}),v=v.slice(3+n)}w.push({name:"signature",letters:v.slice(0,104),value:$.encode(k.fromWordsUnsafe(R))}),v=v.slice(104),w.push({name:"checksum",letters:v});let i={paymentRequest:g,sections:w,get expiry(){let t=w.find(c=>c.name==="expiry");if(t)return a("timestamp")+t.value},get route_hints(){return w.filter(t=>t.name==="route_hint").map(t=>t.value)}};for(let t in K)t!=="route_hint"&&Object.defineProperty(i,t,{get:()=>a(t)});return i;function a(t){let c=w.find(l=>l.name===t);return c?c.value:void 0}}(f);if(!o||!o.sections)return null;const h=o.sections.find(g=>g.name==="payment_hash");if((h==null?void 0:h.name)!=="payment_hash"||!h.value)return null;const p=h.value;let d=0;const u=o.sections.find(g=>g.name==="amount");(u==null?void 0:u.name)==="amount"&&u.value&&(d=parseInt(u.value)/1e3);const y=o.sections.find(g=>g.name==="timestamp");if((y==null?void 0:y.name)!=="timestamp"||!y.value)return null;const x=y.value;let B;const W=o.sections.find(g=>g.name==="expiry");(W==null?void 0:W.name)==="expiry"&&(B=W.value);const U=o.sections.find(g=>g.name==="description");return{paymentHash:p,satoshi:d,timestamp:x,expiry:B,description:(U==null?void 0:U.name)==="description"?U==null?void 0:U.value:void 0}}catch{return null}};if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");export{ie as decodeInvoice};
